# GitHub Pages Publisher

Publishes security scan results as static HTML pages to GitHub Pages.

> **ğŸ”’ Security**: This action **requires Private Pages** (GitHub Enterprise Cloud). It will verify Pages visibility before deployment and **refuse to publish** if Pages is configured as public.

## Features

- ğŸ“„ **Static HTML pages** - No build step, instant deployment
- ğŸ“Š **Organized by channel** - Separate scan histories for different environments
- ğŸ” **Interactive viewing** - Browse all scans with timestamp-based navigation
- ğŸ“¦ **Retention management** - Automatically cleans up old scans
- ğŸ”’ **Private Pages enforced** - Refuses to deploy to public Pages sites

## Structure

```
docs/                          # GitHub Pages root
â”œâ”€â”€ index.html                # Main page (all channels)
â”œâ”€â”€ style.css                 # Shared CSS
â””â”€â”€ scans/
    â”œâ”€â”€ nightly-master/
    â”‚   â”œâ”€â”€ index.html        # Channel page (all scans)
    â”‚   â”œâ”€â”€ 2025-11-07-033946Z/
    â”‚   â”‚   â”œâ”€â”€ index.html    # Scan detail page
    â”‚   â”‚   â”œâ”€â”€ trivy-fs-results.json
    â”‚   â”‚   â”œâ”€â”€ trivy-image-results.json
    â”‚   â”‚   â””â”€â”€ opengrep-results.json
    â”‚   â””â”€â”€ 2025-11-07-101234Z/
    â”‚       â””â”€â”€ ...
    â””â”€â”€ pr-123/
        â””â”€â”€ ...
```

## Usage

### In workflow

```yaml
- name: Publish to GitHub Pages
  uses: Avarko/gh-security-toolkit/actions/publisher/github-pages@main
  with:
    outdir: ${{ steps.setup.outputs.output_dir }}
    metadata_timestamp: ${{ steps.ts.outputs.ts }}
    metadata_branch: ${{ inputs.branch }}
    metadata_repository: ${{ inputs.repository }}
    metadata_commit_sha: ${{ inputs.commit_sha }}
    channel: nightly-master
    pages_root: docs
    retention_keep: 50

- name: Deploy to GitHub Pages
  uses: actions/deploy-pages@v4
```

### Configure GitHub Pages

**âš ï¸ Important**: This publisher will **refuse to deploy** if Pages is configured as public.

1. Go to repository **Settings** â†’ **Pages**
2. **Source**: Deploy from a branch
3. **Branch**: Select your branch (e.g., `main`) and `/docs` folder
4. **Visibility**: Select **"Private"** (GitHub Enterprise Cloud only)
   - âœ… **Private**: Only organization members can access
   - âŒ **Public**: Action will fail with error message

**If you don't have GitHub Enterprise Cloud:**
- Private Pages is not available on GitHub.com (free)
- Use `publish_to: "github-release"` instead

### Permissions required

```yaml
permissions:
  contents: write
  pages: write
  id-token: write
```

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `outdir` | Directory containing scan outputs | Yes | - |
| `metadata_timestamp` | Scan timestamp (e.g., `2025-11-07-033946Z`) | Yes | - |
| `metadata_branch` | Git branch name | No | `""` |
| `metadata_repository` | Repository name (owner/repo) | No | `""` |
| `metadata_commit_sha` | Git commit SHA | No | `""` |
| `metadata_image_name` | Docker image name | No | `""` |
| `metadata_scan_id` | Scan run ID | No | `""` |
| `channel` | Channel name for organizing scans | Yes | - |
| `pages_root` | Root directory for GitHub Pages | No | `docs` |
| `retention_keep` | Keep at most N scans per channel | No | `50` |

## Outputs

| Output | Description |
|--------|-------------|
| `pages_url` | URL to the GitHub Pages site |

## Comparison: GitHub Pages vs GitHub Releases

| Feature | GitHub Pages | GitHub Releases |
|---------|--------------|-----------------|
| **No Git tags** | âœ… Yes | âŒ No (creates tags) |
| **Private access** | âœ… Yes (Enterprise required) | âœ… Yes |
| **Security check** | âœ… Enforced (fails if public) | âš ï¸ Best-effort |
| **UI/UX** | âœ… Better (HTML pages) | âš ï¸ Basic (release list) |
| **Retention** | âœ… File-based cleanup | âœ… API-based cleanup |
| **History view** | âœ… All scans on one site | âš ï¸ Separate releases |
| **Setup complexity** | âš ï¸ Requires Pages + Enterprise | âœ… Works immediately |

## Examples

### Use both publishers

```yaml
inputs:
  publish_to: 'github-release,github-pages'  # Publish to both
```

### Channel-specific retention

```yaml
- name: Publish nightly scans
  uses: Avarko/gh-security-toolkit/actions/publisher/github-pages@main
  with:
    channel: nightly-master
    retention_keep: 30  # Keep last 30 nightly scans

- name: Publish PR scans
  uses: Avarko/gh-security-toolkit/actions/publisher/github-pages@main
  with:
    channel: pr-${{ github.event.pull_request.number }}
    retention_keep: 10  # Keep last 10 PR scans
```

## Developer Notes

The static HTML is generated by `scripts/github_pages_builder.java` using:
- **JBang** for scripting
- **Gson** for JSON parsing
- **Plain HTML/CSS** (no build step)

To test locally:
```bash
jbang scripts/github_pages_builder.java \
  ./scan-output \
  ./docs \
  2025-11-07-033946Z \
  test-channel
```
